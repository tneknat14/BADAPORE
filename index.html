<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Bacolod Damaged Electrical Posts</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body { font-family: Arial; margin: 20px; }
        #map { height: 500px; margin-top: 20px; }
        form { margin-bottom: 20px; }
        input, textarea { width: 100%; margin-bottom: 10px; padding: 5px; }
        img.uploaded { max-width: 200px; display: block; margin-top: 5px; }
    </style>
</head>
<body>

<h2>Report Damaged Electrical Post - Bacolod</h2>

<form id="reportForm">
    Description:<br>
    <textarea id="description" required></textarea><br>
    Barangay:<br>
    <input type="text" id="barangay" required><br>
    Photo:<br>
    <input type="file" id="photo" accept="image/*" required><br>
    <button type="submit">Submit Report</button>
</form>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map = L.map('map').setView([10.6769, 122.5637], 13); // Bacolod center
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let reports = [];
let tempMarker;

// Click to pick coordinates
map.on('click', function(e) {
    if(tempMarker) map.removeLayer(tempMarker);
    tempMarker = L.marker(e.latlng).addTo(map);
    tempMarker.bindPopup("Selected location").openPopup();
});

// Handle form submission
document.getElementById('reportForm').addEventListener('submit', function(e){
    e.preventDefault();

    if(!tempMarker) {
        alert("Please select a location on the map!");
        return;
    }

    let description = document.getElementById('description').value;
    let barangay = document.getElementById('barangay').value;
    let photoFile = document.getElementById('photo').files[0];

    if(photoFile) {
        let reader = new FileReader();
        reader.onload = function(event) {
            let photoData = event.target.result;

            let report = {
                description: description,
                barangay: barangay,
                lat: tempMarker.getLatLng().lat,
                lng: tempMarker.getLatLng().lng,
                photo: photoData
            };

            reports.push(report);

            let marker = L.marker([report.lat, report.lng]).addTo(map);
            marker.bindPopup(
                `<b>Barangay:</b> ${report.barangay}<br>
                 <b>Description:</b> ${report.description}<br>
                 <img src="${report.photo}" class="uploaded">`
            );

            alert("Report added to the map!");
            // Reset form
            document.getElementById('reportForm').reset();
            map.removeLayer(tempMarker);
            tempMarker = null;
        }
        reader.readAsDataURL(photoFile);
    }
});
</script>

</body>
</html>
